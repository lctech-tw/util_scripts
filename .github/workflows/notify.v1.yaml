name: notify.v1
on:
  workflow_call:
    inputs:
      CI_STATUS:
        description: 'Status of CI, can be success, skipped, cancelled, or failure'
        required: true
        type: string
      GROUP:
        default: 'jkf'
        description: 'Slack group name, can be [ jkf, jvid, jkface ]'
        required: true
        type: string
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: ‚öôÔ∏è Checkout code
        uses: actions/checkout@v3
      - name: ‚öôÔ∏è Authenticate to Google Cloud
        uses: google-github-actions/auth@v1
        with:
          credentials_json:  ${{ secrets.GCP_SA_KEY_GITHUB_CI }}
      - name: ‚öôÔ∏è Initialize Google Cloud SDK
        uses: google-github-actions/setup-gcloud@v1
      - name: üì® Notification via Slack
        if: always()
        run: |
          curl -sLJO https://raw.githubusercontent.com/lctech-tw/util_scripts/main/notify_slack.sh 
          case ${{ inputs.CI_STATUS }} in
          success)
            echo "Run slack on Success (O)"
            bash ./notify_slack.sh -s -g=${{ inputs.GROUP }}
            ;;
          skipped|cancelled)
            echo "Run slack on Skipped (-) ----------------"
            ;;
          failure)
            echo "Run slack on Fail (X)"
            bash ./notify_slack.sh -f -g=${{ inputs.GROUP }}
            ;;
          esac
